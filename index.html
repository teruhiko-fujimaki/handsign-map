<!DOCTYPE html>
<html>
  <head>
    <title>Maps Demo</title>
    <style>
      #map {
        height: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>
    <script>
      function initMap() {
        // The location of Osaka
        const osaka = {lat: 34.6937, lng: 135.5023};
        // The map, centered at Osaka
        const map = new google.maps.Map(
            document.getElementById('map'), {zoom: 10, center: osaka});

        // Fetch the GeoJSON data.
        fetch('facilities.geojson')
          .then(response => response.json())
          .then(data => {
            // Create an array of markers.
            const markers = data.features.map(feature => {
              const gmaps = google.maps;
              const position = {
                lat: feature.geometry.coordinates[1],
                lng: feature.geometry.coordinates[0]
              };
              const marker = new gmaps.Marker({
                position: position,
              });

              // Create an info window for each marker.
              const infoWindow = new google.maps.InfoWindow({
                content: `
                  <h3>${feature.properties.name}</h3>
                  <p><strong>Address:</strong> ${feature.properties.address}</p>
                  <p><strong>Note:</strong> ${feature.properties.note}</p>
                `
              });

              // Show the info window when a marker is clicked.
              marker.addListener('click', () => {
                infoWindow.open(map, marker);
              });

              return marker;
            });

            // Add a marker clusterer to group the markers.
            new markerClusterer.MarkerClusterer({map, markers});
          });
      }
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=*************************************&callback=initMap">
    </script>
  </body>
</html>
